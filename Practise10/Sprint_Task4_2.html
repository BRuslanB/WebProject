<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sprint Task 4 (Login Page)</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
        .error {
            height: 25px;
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-4">
                <div class="mb-3">
                    <label for="loginField" class="form-label">Your login</label>
                    <input id="loginField" type="text" class="form-control">
                    <div id="loginError" class="error"></div>
                </div>
                <div class="mb-3">
                    <label for="passwordField" class="form-label">Your password</label>
                    <input id="passwordField" type="password" class="form-control">
                    <div id="passwordError" class="error"></div>
                </div>
                <div class="mb-3 d-flex justify-content-between" >
                    <button class="btn btn-primary" onclick="login()">Login</button>
                    <button class="btn btn-outline-primary" onclick="registerPage()">To Register Page</button>
                </div>
                <div id="messageError" class="error"></div>
            </div>
        </div>
    </div>
    <!-- Modal dialog-->
    <div id="myModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Welcome!</h4>
                </div>
                <div class="modal-body">
                    <p>Authentication was successful</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
                </div>
            </div>
        </div>
    </div>
    <script src="js/bootstrap.bundle.min.js"></script>
</body>
<script>
    //вызов функции Login
    function login() {
        // проверки на пустые поля
        let login = loginField.value;
        if (login === null || login === '') {
            loginError.innerHTML = 'Please enter your login...';
            loginField.focus();
            return;
        }
        let password = passwordField.value;
        if (password === null || password === '') {
            passwordError.innerHTML = 'Please enter your password...';
            passwordField.focus();
            return;
        }
        //поиск по localStorage
        let pos = -1;
        if (localStorage.users != null){
            let users = [];
            users = JSON.parse(localStorage.users);
            for (let i = 0; i < users.length; i++)
                if (login == users[i]["login"] && password == users[i]["password"]) {
                    pos = i;
                    break;
                }
        }
        //очищаем поля
        loginField.value = "";
        passwordField.value = "";
        //результаты поиска
        if (pos === -1) {
            messageError.innerHTML = 'There is no user with such login and password';
            loginField.focus();
        } else {
            // получим модальное окно
            const modal = new bootstrap.Modal(document.querySelector('#myModal'));
            modal.show();
        }
    }

    // реагируем на события фокусировки
    loginField.onblur = function() {
        loginError.innerHTML = '';
        messageError.innerHTML = '';
    }
    passwordField.onblur = function() {
        passwordError.innerHTML = '';
        messageError.innerHTML = '';
    }

    // переходим на страничку Register
    function registerPage() {
        window.location = "Sprint_Task4_1.html";
    }
</script>
</html>